# Public Domain (-) 2011 The Togethr Authors.
# See the Togethr UNLICENSE file for details.

import json

from bolt.api import *

chrome_tmpl = """// Public Domain (-) 2011 The Togethr Authors.
// See the Togethr UNLICENSE file for details.

// N.b.: This file is autogenerated by `bolt build_chrome`.

package togethr

const chrome = `%s`"""

@task
def build_chrome():

    # read the assetgen manifest json
    sock = open('app/build/assets.json')
    assets = json.loads(sock.read())
    sock.close()

    # render the template
    sock = open('chrome.tmpl')
    tmpl = chrome_tmpl % sock.read()
    sock.close()

    data = dict((k.replace('.', '_'), v) for k, v in assets.items())
    chrome = tmpl.strip() % data

    # write to file
    sock = open('app/togethr/chrome.go', 'w')
    sock.write(chrome)
    sock.close()
